<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Animator</title>

        <!-- Internal style for this component specific HTML file. -->
        <style>
            html, body {
                /*
                 * Margin and padding set to zero as default.
                 * Then, content is fit exactly into iframe if it is used.
                 */
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
            }
            body {
                font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
            }
            .animatorContainer {
                width: 100%;
                height: 100%;
            }
        </style>

        <!-- Stylesheets -->
        <link rel="stylesheet" type="text/css" href="../dist/deps/jquery-ui-1.10.3/jquery-ui.min.css" />
        <link rel="stylesheet" type="text/css" href="../dist/deps/OpenLayers-2.13.1/theme/default/style.css" />
        <!-- Component styles may override defaults. -->
        <link rel="stylesheet" type="text/css" href="../dist/components/animator/css/style-min.css" />

        <!-- JavaScript libraries -->
        <script type="text/javascript" src="../dist/deps/lodash/lodash.compat-2.1.0-min.js"></script>
        <script type="text/javascript" src="../dist/deps/timestep.js"></script>
        <script type="text/javascript" src="../dist/deps/OpenLayers-2.13.1/OpenLayers.js"></script>
        <script type="text/javascript" src="../dist/deps/jquery/jquery-1.10.2-min.js"></script>
        <script type="text/javascript" src="../dist/deps/jquery-mousewheel/jquery.mousewheel-min.js"></script>
        <script type="text/javascript" src="../dist/deps/jquery-ui-1.10.3/jquery-ui.min.js"></script>
        <script type="text/javascript" src="../dist/deps/raphael/raphael-2.1.0-min.js"></script>
        <script type="text/javascript" src="../dist/deps/animation/openlayers-animation-1.0.1-min.js"></script>
        <script type="text/javascript" src="../dist/components/animator/js/animator-min.js"></script>
        <script type="text/javascript" src="../dist/components/animator/js/config.js"></script>

        <script type="text/javascript">
            $(function() {
                // When document is ready.

                function read_url_params() {

                    var params = {};

                    if (location.search) {
                        var parts = location.search.substring(1).split('&');

                        for (var i = 0; i < parts.length; i++) {
                            var nv = parts[i].split('=');
                            if (!nv[0]) continue;
                            params[nv[0]] = nv[1] || true;
                        }
                    }

                    return params;
                }

                function init_animator(config) {
                    animator = new fi.fmi.metoclient.ui.animator.Animator();
                    animator.init(
                        {
                            // Animator content is inserted into container.
                            // Default animator element structures are used here.
                            animatorContainerDivId : "animatorContainerId",
                            // Configuration defines map and layers for animator.
                            // Notice, fi.fmi.metoclient.ui.animator.Config object is also used
                            // as a default if config is not provided. But, this is shown here
                            // as an example. Another config object may also be provided here.
                            // See comments in fi.fmi.metoclient.ui.animator.Config for more detailed
                            // description of the config object.
                            config : config,
                            // Callback is mandatory if getConfig function needs to be used.
                            callback : function(animator, errors) {
                                // For example, animator map object is available after initialization.
                                map = animator.getFactory().getMap();
                            }
                        });
                }

                var params = read_url_params();

                if (params.conf !== undefined) {
                    console.log("Fetching config from", params.conf);
                    $.ajax(params.conf, {
                        dataType: "json",
                    }).done(function(conf) {
                        console.log("Got config");
                        init_animator(conf);
                    }).fail(function(xhr, textStatus, errorThrown) {
                        console.error("Failed to get config", xhr, textStatus, errorThrown);
                        $("animatorContainerId").html("<p>Loading configuration failed</p>");
                    });
                } else {
                    init_animator(fi.fmi.metoclient.ui.animator.Config);
                }


            });
        </script>
    </head>
    <body>

        <div class="animatorContainer" id="animatorContainerId">
            <!-- Insert component here. -->
        </div>

    </body>
</html>
